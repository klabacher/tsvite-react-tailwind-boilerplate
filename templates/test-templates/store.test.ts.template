import { describe, it, expect, beforeEach } from 'vitest';
import { store } from '../store/store';
import { 
  toggleTheme, 
  setTheme,
  selectTheme 
} from '../store/slices/appSlice';

describe('Redux Store', () => {
  beforeEach(() => {
    store.dispatch(setTheme('dark'));
  });

  describe('Store Configuration', () => {
    it('should have initial state', () => {
      const state = store.getState();
      expect(state).toBeDefined();
      expect(typeof state).toBe('object');
    });

    it('should have app slice', () => {
      const state = store.getState();
      expect(state.app).toBeDefined();
    });

    it('should have initial theme of dark', () => {
      const state = store.getState();
      expect(selectTheme(state)).toBe('dark');
    });
  });

  describe('Theme Actions', () => {
    it('should toggle theme from dark to light', () => {
      store.dispatch(toggleTheme());
      const state = store.getState();
      expect(selectTheme(state)).toBe('light');
    });

    it('should toggle theme from light to dark', () => {
      store.dispatch(setTheme('light'));
      store.dispatch(toggleTheme());
      const state = store.getState();
      expect(selectTheme(state)).toBe('dark');
    });

    it('should set theme to light', () => {
      store.dispatch(setTheme('light'));
      const state = store.getState();
      expect(selectTheme(state)).toBe('light');
    });

    it('should set theme to dark', () => {
      store.dispatch(setTheme('light'));
      store.dispatch(setTheme('dark'));
      const state = store.getState();
      expect(selectTheme(state)).toBe('dark');
    });

    it('should handle multiple sequential actions', () => {
      store.dispatch(toggleTheme()); // dark -> light
      store.dispatch(toggleTheme()); // light -> dark
      store.dispatch(toggleTheme()); // dark -> light
      const state = store.getState();
      expect(selectTheme(state)).toBe('light');
    });
  });

  describe('Selectors', () => {
    it('should select theme correctly', () => {
      store.dispatch(setTheme('light'));
      expect(selectTheme(store.getState())).toBe('light');
    });
  });

  describe('Store Subscription', () => {
    it('should notify subscribers on state change', () => {
      let callCount = 0;
      const unsubscribe = store.subscribe(() => {
        callCount++;
      });

      store.dispatch(toggleTheme());
      store.dispatch(toggleTheme());

      expect(callCount).toBe(2);
      unsubscribe();
    });
  });
});
